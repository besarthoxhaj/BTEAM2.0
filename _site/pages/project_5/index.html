<!DOCTYPE html>
<html lang="en">
  
<head>
    <!-- META DATA -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <meta name="description" content="Treble theme - One Page Responsive Theme - Gridelicious.net">
    <title>Bteam FC project page and blog</title>

    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/images/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/images/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/images/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="/assets/images/ico/apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="/assets/images/ico/favicon.png">
                                   
    <!-- STYLESHEETS -->
    <link rel="stylesheet" href="/assets/style/bootstrap.css"/>
    
    <!-- GOOGLE WEB FONTS -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,700,600,300,800' rel='stylesheet' type='text/css'>
</head>
<body>
    <!-- NAVIGATION -->
    <nav class="fixed-top fixed-visable" id="navigation">
        <div class="container">
            <div class="row-fluid">
                <div class="span12 center">
                    <!-- LOGO -->
                    <a class="brand pull-left" href="/#page-welcome">
                        <img src="/assets/images/logo.png" alt="Treble">
                    </a>
                    <!-- END LOGO -->

                    <!-- MOBILE MENU BUTTON -->
                    <div class="mobile-menu" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </div>
                    <!-- END MOBILE MENU BUTTON -->
                    
                    <!-- MAIN MENU -->
                    <ul id="main-menu" class="nav-collapse collapse">
                        <li><a href="/#page-welcome">Home</a></li>
                        <li><a href="/#page-work">Work</a></li>
                        <li><a href="/#page-features">Features</a></li>
                        <li><a href="/#page-about">About</a></li>
                        <li><a href="/#page-blog">Blog</a></li>
                        <li><a href="/#page-contact">Contact</a></li>
                    </ul>
                    <!-- END MAIN MENU -->
                    
                    <!-- SOCIAL ICONS -->
                    <div class="social-icons hover-big pull-right">
                        <a href="#" class="sicon-facebook"><i>Facebook</i></a>
                        <a href="#" class="sicon-twitter"><i>Twitter</i></a>
                        <a href="#" class="sicon-linkedin"><i>LinkedIn</i></a>
                        <a href="#" class="sicon-youtube"><i>Youtube</i></a>
                        <a href="#" class="sicon-pinterest"><i>Pinterest</i></a>
                    </div>
                    <!-- END SOCIAL ICONS -->
                </div>
            </div>
        </div>
    </nav>
    <!-- END NAVIGATION -->
  
      <div class="pages page-blog-list" id="page-blog-list">
        <div class="container">
            <!-- Header -->
            <header>
                <h4 class="line-divider">The price of Cocaine</h4>
            </header>
            <!-- End Header -->
         <div id="map" class="span5" style="background:#fcfcfa; border-style:groove; width:400; height:300;">
  <div>
    <button id="btn-retail">Retail price</button>
    <button id="btn-whole">Whole price</button>
  </div>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script>
    var color = "red";
    var selected_index = 0;

    function startAnimation () {

      var width = 400,
          height = 300,
          speed = -1e-2,
          start = Date.now();

      var sphere = {type: "Sphere"};

      var projection = d3.geo.orthographic()
      .scale(width / 3)
      .clipAngle(90)
      .translate([width / 2.8, height / 2]);

      var graticule = d3.geo.graticule();

      var canvas = d3.select("#map").append("canvas")
      .attr("width", width)
      .attr("height", height);

      var context = canvas.node().getContext("2d");

      var path = d3.geo.path()
      .projection(projection)
      .context(context);

      d3.json("/assets/js/data.json", function(rawData){

        var price = {};
        /* store data on the fly
                    var price = {
                        ID: [
                        "retail_price",
                        "wholesale_price",
                        "country_name"]
                    }
                    */

        for (var i=0; i<rawData.length; i++){
          var datum = rawData[i];
          var country_id = datum["Alpha-2"],
              retail_price = datum["Retail price"],
              wholesale_price = datum["Wholesale price"],
              country_name = datum["Country name"];

          price[country_id] = [retail_price, wholesale_price, country_name];
        }

        console.log("Hello World");
        console.log(price);


        d3.json("/assets/js/world.json", function(error, topo) {
          var land = topojson.feature(topo, topo.objects.subunits),
              grid = graticule();

          d3.timer(function() {
            var λ = speed * (Date.now() - start),
                φ = -15;

            context.clearRect(0, 0, width, height);

            context.beginPath();
            path(sphere);
            context.lineWidth = 3;
            context.strokeStyle = "#000";
            context.stroke();
            context.fillStyle = "#fff";
            context.fill();

            context.save();
            context.translate(width / 2.8, 0);
            context.scale(-1, 1);
            context.translate(-width / 2.8, 0);
            projection.rotate([λ + 180, -φ]);

            context.beginPath();
            path(land);
            context.fillStyle = "#dadac4";
            context.fill();

            context.beginPath();
            path(grid);
            context.lineWidth = .1;
            context.strokeStyle = "rgba(119,119,119,.5)";
            context.stroke();

            context.restore();
            projection.rotate([λ, φ]);

            context.beginPath();
            path(grid);
            context.lineWidth = .1;
            context.strokeStyle = "rgba(119,119,119,.5)";
            context.stroke();

            context.beginPath();
            path(land);
            context.fillStyle = "#eeeeee";
            context.fill();
            context.lineWidth = .5;
            context.strokeStyle = "#000";
            context.stroke();

            var upper_end = [200, 30000][selected_index];
            var colorScale = d3.scale.linear()
            .domain([0, upper_end])
            .range(["white", color]);

            for (a=0; a<land.features.length; a++) {

              if (price[land.features[a].id] && price[land.features[a].id][selected_index] ) {
                context.beginPath();
                path(land.features[a]);
                context.fill();
                context.fillStyle = colorScale(price[land.features[a].id][selected_index]);
                context.lineWidth = .5;
                context.strokeStyle = "#000";
                context.stroke();
              };
            };
          });
        });
        d3.select(self.frameElement).style("height", height + "px");
      });
    }

    startAnimation();

    d3.select("#btn-retail").on("click", function() {
      selected_index = 0;
    });

    d3.select("#btn-whole").on("click", function() {
      selected_index = 1;
    });
  </script>
  
  
</div>

<div id="map" class="span5">
  <article>
    The project is finished and this is our result. The map shows the price per gram and them per kilo of cocaine around the world.
  </article>
</div>   
        </div>
     </div>
</body>
</html>